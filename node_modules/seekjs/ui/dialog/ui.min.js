/**
 * 弹框插件
 */

define("sys.ui.dialog",function (req, exp) {
	"use strict";

exp.getTemplate = function($){var buf = [];
buf.push('<div class="sk-dialog-position">    <div>        <div class="sk-dialog">           <div class="sk-dialog-top">                <div class="sk-dialog-tit">                    <strong>');
buf.push(this.title);
buf.push('</strong>                </div>               ');
if(this.hasClose){
buf.push('               <div class="sk-dialog-close" data-event="hide"></div>               ');
}
buf.push('            </div>            <div class="sk-dialog-cont">                <div class="sk-dialog-txt" >                    ');
if(this.url==""){
buf.push('                    <p>');
buf.push(this.text);
buf.push('</p>                    ');
}else{
buf.push('                    <iframe src="');
buf.push(this.url);
buf.push('"></iframe>                    ');
}
buf.push('                </div>            </div>            <div class="sk-dialog-btn">                ');
if(this.hasCancel){
buf.push('                <div class="sk-dialog-cancel"  data-event="pickCancel">');
buf.push(this.cancelText);
buf.push('</div>                ');
}
buf.push('                ');
if(this.hasOk){
buf.push('                <div class="sk-dialog-ture" data-event="pickOk">');
buf.push(this.okText);
buf.push('</div>                ');
}
buf.push('                ');
var sn,src;for(var i in this.buttons){
var item=this.buttons[i];
sn=i*1+1;
src={length:this.buttons.length, first:i==0, last:i==this.buttons.length-1};
buf.push('                <div class="sk-dialog-cancel"  data-event="pickButton:');
buf.push(i);
buf.push('">');
buf.push(item);
buf.push('</div>                ');
}
buf.push('            </div>            <div class="sk-com-clear"></div>        </div>    </div>    <div class="sk-dialog-bg"></div></div>');
return buf.join("");};


    var filter = req("sys.filter");

	var mod = exp.model = {
        title: "提示",
        text: "内容",
        url: "",
        okText: "确定",
        cancelText: "取消",
        hasClose: false,
        hasOk: true,
        hasCancel : false,
        onOk: null,
        onCancel: null,
        onButton: null
    };

    exp.mediaStyle = true;
    exp.timer = null;

    //点击确定按钮
    exp.pickOk = function(){
        exp.timer && window.clearTimeout(exp.timer);
        exp.hide();
        mod.onOk && mod.onOk();
    };

    //点击取消按钮
    exp.pickCancel = function(){
        exp.hide();
        mod.onCancel && mod.onCancel();
    };

    //点击其他按钮
    exp.pickButton = function(index){
        exp.hide();
        mod.onButton && mod.onButton(index);
    };


    //警告框
    exp.alert = function(ops){
        if(typeof ops!="object") {
            ops = {text: ops};
            for(var i=1; i<arguments.length; i++){
               var v = arguments[i];
               typeof v == "number" && (ops.timeout = v);
               typeof v == "function" && (ops.onOk = v);
            }
        }
        ops.hasCancel = false;
        exp.showDialog(ops);
    };

    //确认框
    exp.confirm = function(ops){
        if(typeof ops!="object"){
            ops = {
                text: arguments[0],
                onOk: arguments[1],
                onCancel: arguments[2]
            };
        }
        ops.hasCancel = true;
        exp.showDialog(ops);
    };

    //显示对话框
    exp.showDialog = function(ops){
        filter.mergeObj(mod, ops);
        mod.onOk = ops.onOk || null;
        mod.onCancel = ops.onCancel || null;
        exp.show();
        exp.render();

        if(ops.timeout>0){
            exp.timer = window.setTimeout(exp.pickOk, ops.timeout);
        }
    };


});